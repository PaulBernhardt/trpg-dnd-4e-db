<!--
  - action_view.html
  - View content of an entry / multiple entries
  -->
<div id='action_view' data-role='page'>

   <header>
      <button class='i18n' onclick='od.gui.goto(od.action.list.url_current);'> action.list.link_text </button>
      <h1 id="action_view_h_title"></h1>
   </header>

   <article id="act_view_pnl_content"></article>
</div>

<script type='text/javascript'>'use strict';(function action_view_init(){
od.action.view = {

   "initialize" : null,

   "setup" : null,

   "cleanup" : function action_view_cleanup () {
      this.clear();
   },

   /////////////////////////////////////////////////////////////////////////////////////////////////

   "clear" : function act_view_clear() { _( '#act_view_pnl_content')[0].innerHTML = ""; },

   "show_data" : function act_view_show_data( title, data ) {
      this.clear();
      var latch = new _.Latch( data.length+1 );
      _('#action_view_h_title')[0].textContent = title;
      // Load all data
      data.forEach( function act_view_show_data_load (e) {
         e[0].load_data( e[1], latch.count_down_function() );
      });
      // After data load, put them together and switch url
      latch.ondone = function act_view_show_data_show () {
         var url = [];
         data.forEach( function(e) {
            _( '#act_view_pnl_content')[0].appendChild( _.create( 'div', {
               html: od.gui.symbol_safe_convert( e[0].data[ e[1] ] )
            } ) );
            url.push( e[0].name + '.' + od.config.id( e[1] ) );
         } );
         od.gui.goto( "view=" + url.join( ',' ) );
      };
      latch.count_down();
   }
};

})();</script>