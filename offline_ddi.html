<!DOCTYPE html><html><head><meta charset="utf-8" />
<!--
  - html_doctype.html
  - Doctype and meta declarations
  -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
/*
 * style.css
 */

* {
   box-sizing: border-box;
   -moz-box-sizing: border-box;
   -webkit-box-sizing: border-box;
}

html, body, div, th, td { margin: 0; padding: 0; }

html, body {
   width: 100%;
   background-color: #DDD;
}


.right { float: right; }
.left { float: left; }
.hide { display: none; }

/** Action divs */
body > div[id^="action_"] {
   display: none;
   width: 100%;
   padding: 1em;
}

.button {
   display: inline-block;
   padding: 0.5ex 1ex;
   border-radius: 1ex;
   border: 1px outset #888;
}/*
 * html_header.html
 * Title, link, etc.
 */
  </style>
  <title> Offline Compendium </title>
</head><body>
<script>'use strict';
/*
 * code_util.js
 * Utility codes, including initial detection of browser feature and no script.
 */

// Main namespace
var oddi = {};
 
// Simple check for browser features
if ( ! document.querySelectorAll || !window.Storage ) {
   alert('Please upgrade browser.');
}
 
function _( cssSelector ) {
   return document.querySelectorAll( cssSelector );
}

_.ajax = function _ajax( url, data, onsuccess, onfail, ondone ) {
   var xhr = new XMLHttpRequest();
   xhr.open( url, 'POST' );
   //xhr.mozBackgroundRequest = true;
   xhr.onreadystatechange = function _ajax_onreadystatechange() {
      if ( xhr.readyState == 4 ) {
         if ( [200,302].indexOf( xhr.status ) >= 0 ) {
            if ( onsuccess ) onsuccess(xhr);
         } else {
            if ( onfail ) onfail(xhr);
         }
         if ( ondone ) ondone(xhr);
      }
   }
   xhr.send();
   return xhr;
}

_.js = function _js( url, onload ) {
   var e = document.createElement( 'script' );
   e.src = url;
   if ( onload ) e.addEventListener('load', onload);
   e.addEventListener('load', function(){ document.body.removeChild(e) });
   document.body.appendChild( e );
}

</script><noscript>
   <h1> Please enable JavaScript </h1>
   <h1> 請啟用 JavaScript </h1>
</noscript><script>'use strict';
/*
 * code_gui.js
 * GUI-related codes, but activity-specific codes are coded with activities.
 */
 
// Action object. Would be populated by individual actions
oddi.action = {};

// 
oddi.gui = {
   /** Current action */
   action: null,
   
   switch_action :
      /**
       * Switch between actions. Would call action object's cleanup method for current action and setup method for next action.
       */
      function gui_switch_action( action ) {
         var currentAction = oddi.gui.action;
         if ( !action || action == currentAction ) return;

         // Pre-switch validation & cleanup
         if ( currentAction && currentAction.cleanup && currentAction.cleanup( action ) === false ) return false;

         Array.prototype.forEach.call(_("body > div[id]"), function(e){ e.style.display = ''; });
         _( "#"+action.id )[0].style.display = 'block';

         // Post-switch setup
         if ( action.setup ) action.setup( action );

         oddi.gui.action = action;
      }
}

</script><script>'use strict';
/*
 * data_model.js
 * Create data model in memory
 */

oddi.data = {
   category : { "Sample": 2 },
   data : {
      "Sample" : {
         columns: [ "Id", "Name", "Category", "Source" ],
         listing: [ [ "sampleId001", "Sample Data 1", "Sample1", "Git" ],
                    [ "sampleId003", "Sample Data 2", "Sample2", "Git" ], ],
         index: {"this":[0,1],"sample":[0],"data":[0,1],"sampleId001":[0],"another":[1],"that":[1],"example":[1]},
         data: [ "<p>This is sample data id sampleId001</p>" ], // Data at index 2 not loaded yet
      }
   },
   /** Clear all loaded data or a category of data */
   clear: function data_reset( category ) {
      if ( category ) {
         var pos = this.category.indexOf( category );
         if ( pos ) {
            this.category.splice( pos, 1 );
            delete this.data[category];
         } else {
            if ( console ) console.log("Warning: Cannot reset category "+category);
         }
      } else {
         this.category = [];
         this.data = {};
      }
   }
}


/*
oddi.data = {
   data: { "cat": {
      "count": entry_count,
   },
}
*/

</script><script>'use strict';
/*
 * data_read.js
 * Read data from persistent storage
 */

 oddi.reader = {
    _loaded: {},
    _timeout: 1 * 1000,

    read_index: function reader_read_index( version, data ) {
       var src = 'data/index.jsonp';
       if ( ! version ) {
          this._loaded[src] = setTimeout(function(){
             // timeout
             alert('timeout');
          }, this._timeout);
          _.js(src, function(a){ if ( oddi.reader._loaded[src] ) {
             // error
             alert('error');
          }});
       } else {
          oddi.data.category = data;
          clearTimeout( this._loaded[src] );
          delete this._loaded[src];
       }
    },
    read_data_listing: function reader_read_data_listing( version, category, columns, data ) {
       oddi.data.data[category] = {
          columns: columns,
          listing: data,
          index: {},
          data: [],
       }
    },
    read_data_index: function reader_read_data_index( version, category, data ) {
       oddi.data.data[category].index = data;
    },
    read_data: function reader_read_data( version, category, startIndex, data ) {
       var ary = oddi.data.data[category].data;
       for ( var i = 0 ; i <= 99 ; i++ ) {
          ary[startIndex+i] = data[i];
       }
    }
 }
</script><script>'use strict';
/*
 * data_index.js
 * Build index from data model.
 */
</script><script>'use strict';
/*
 * data_write.js
 * Write data model to persistent storage.
 * This part needs file permission and currently only works with Firefox
 */
</script><!--
  - action_download.html
  - Query online compendium and shows what can be downloaded / updated.
  -->
<div id='action_download'>
   <h1>Offline Compendium</h1>
   <p>
      This browser script allows you to download and save compendium entries,
      then search it offline using advanced Google-like syntax.
   </p>
   <p>
      <b>Requires an active DDI subscription to download any data.</b>
   </p>
   <p>
      <input type='search' class='right' placeholder='Search' autofocus>
      <a class='button' onclick='oddi.action.download.event.refresh()'> Refresh list </a>
      <label> <input type='checkbox'> Auto refresh </label>
   </p>
   <p> Click 'Refresh' to update listing </p>
</div>
<script>'use strict';

oddi.action.download = {
   id: 'action_download',
   setup: null,
   cleanup: null,
   event: {
      refresh: function download_refresh() {
         oddi.data.clear();
         oddi.reader.read_index();
      }
   }
};

</script><!--
  - action_list.html
  - List and search downloaded entries
  -->
<div id='action_list'>
</div>
<!--
  - action_view.html
  - View entries details
  -->
<div id='action_view'>
</div>
<!--
  - html_footer.html
  - Initialisation code and httml footer
  -->
<script>'use strict';
    // Switch to download action on domready
    window.addEventListener('DOMContentLoaded',function(){ oddi.gui.switch_action( oddi.action.download ); },false);
</script>
</body></html>